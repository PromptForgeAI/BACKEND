# ðŸš€ PromptForge.ai â€” Final MongoDB Database Design (2025)

**Purpose:**
- This file defines the canonical, robust, and secure MongoDB schema for PromptForge.ai.
- All backend and frontend code must align with this design. Any deviations must be documented and patched.

---

## 1. users
- `_id` (string, Firebase UID, PK)
- `email` (string, unique)
- `display_name` (string)
- `photo_url` (string, optional)
- `email_verified` (bool)
- `account_status` (enum: active|suspended|pending|deleted)
- `created_at` (datetime, UTC)
- `last_login_at` (datetime, UTC)
- `last_active_at` (datetime, UTC)
- `subscription` (object: tier, status, stripe_customer_id, etc.)
- `credits` (object: balance, total_purchased, total_spent, last_purchase_at)
- `profile` (object: bio, website, location, company, job_title, expertise, social_links)
- `preferences` (object: theme, language, timezone, notifications, privacy, interface)
- `stats` (object: prompts_created, ideas_generated, tests_run, marketplace_sales, total_earnings, average_rating, total_reviews, followers_count, following_count)
- `partnership` (object: is_partner, partner_tier, application_status, etc.)
- `security` (object: two_factor_enabled, last_password_change, suspicious_activity_detected, gdpr_consent, gdpr_consent_date, data_retention_until)
- `updated_at` (datetime, UTC)
- `version` (int)

## 2. prompts
- `_id` (string, PK)
- `user_id` (string, FK to users)
- `title` (string)
- `description` (string, optional)
- `content` (string)
- `role` (string, optional)
- `category` (string)
- `tags` (array of string)
- `difficulty` (enum: beginner|intermediate|advanced|expert)
- `language` (string, ISO)
- `type` (enum: text|structured|template|workflow)
- `project_id` (string, optional)
- `folder_id` (string, optional)
- `parent_prompt_id` (string, optional)
- `template_id` (string, optional)
- `status` (enum: draft|active|archived|deleted)
- `visibility` (enum: private|shared|public|marketplace)
- `is_template` (bool)
- `is_featured` (bool)
- `version` (int)
- `latest_version_id` (string)
- `has_unsaved_changes` (bool)
- `performance` (object: rating, effectiveness, test_count, success_rate, avg_response_time, token_count)
- `analytics` (object: view_count, use_count, share_count, like_count, download_count, comment_count, last_used_at)
- `marketplace` (object: is_listed, listing_id, price, sales_count, revenue, average_rating, review_count)
- `collaboration` (object: is_collaborative, allowed_users, permissions, active_editors, last_edited_by, lock_expiry)
- `ai_metadata` (object: generated_by, enhanced_by, optimization_history, model_compatibility, parameters)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `created_by` (string)
- `last_modified_by` (string)
- `deleted_at` (datetime, optional)
- `deleted_by` (string, optional)

## 3. prompt_versions
- `_id` (string, PK)
- `prompt_id` (string, FK to prompts)
- `user_id` (string, FK to users)
- `version_number` (int)
- `content` (string)
- `role` (string, optional)
- `type` (string)
- `changes` (string)
- `created_at` (datetime, UTC)
- `created_by` (string)

## 4. ideas
- `_id` (string, PK)
- `user_id` (string, FK to users)
- `title` (string)
- `description` (string)
- `content` (string, optional)
- `generated_by` (object: model, prompt, parameters, session_id, batch_id)
- `category` (string)
- `tags` (array of string)
- `complexity` (enum: simple|moderate|complex|expert)
- `viral_potential` (int)
- `feasibility` (int)
- `status` (enum: raw|reviewed|developing|testing|implemented|abandoned)
- `development_stage` (int)
- `implementation_notes` (string, optional)
- `project_id` (string, optional)
- `related_prompt_ids` (array of string)
- `inspiration_source_ids` (array of string)
- `derived_idea_ids` (array of string)
- `starred` (bool)
- `priority` (enum: low|medium|high|urgent)
- `personal_notes` (string, optional)
- `shared_with` (array of string)
- `comment_count` (int)
- `like_count` (int)
- `ai_enhancement` (object: enhanced_versions, marketability_score, technical_feasibility, business_potential)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `created_by` (string)
- `last_reviewed_at` (datetime, optional)
- `deleted_at` (datetime, optional)

## 5. projects
- `_id` (string, PK)
- `user_id` (string, FK to users)
- `title` (string)
- `description` (string, optional)
- `color` (string, optional)
- `icon` (string, optional)
- `category` (string)
- `tags` (array of string)
- `parent_project_id` (string, optional)
- `template_id` (string, optional)
- `prompt_ids` (array of string)
- `idea_ids` (array of string)
- `resource_ids` (array of string)
- `status` (enum: planning|active|completed|archived|deleted)
- `progress` (int)
- `priority` (enum: low|medium|high|urgent)
- `collaboration` (object: visibility, allowed_users, permissions, team_id)
- `stats` (object: prompt_count, idea_count, collaborator_count, test_count, total_views, last_activity)
- `timeline` (object: start_date, end_date, milestones)
- `settings` (object: auto_save, version_control, enable_comments, public_readonly, allow_forks)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `created_by` (string)
- `last_modified_by` (string)
- `deleted_at` (datetime, optional)
- `deleted_by` (string, optional)

## 6. marketplace_listings
- `_id` (string, PK)
- `seller_id` (string, FK to users)
- `prompt_id` (string, FK to prompts)
- `title` (string)
- `description` (string)
- `short_description` (string)
- `category` (string)
- `tags` (array of string)
- `price` (int)
- `currency` (enum: credits|usd)
- `original_price` (int, optional)
- `discount_percentage` (int, optional)
- `preview_content` (string)
- `screenshots` (array of string)
- `demo_url` (string, optional)
- `quality_score` (int)
- `performance_metrics` (object: average_response_time, success_rate, user_satisfaction)
- `status` (enum: draft|pending|approved|rejected|suspended|deleted)
- `moderation_status` (enum: not_reviewed|under_review|approved|flagged)
- `moderation_notes` (string, optional)
- `moderated_by` (string, optional)
- `moderated_at` (datetime, optional)
- `analytics` (object: view_count, purchase_count, revenue, conversion_rate, refund_count, refund_rate)
- `reviews` (object: average_rating, total_reviews, rating_distribution)
- `seo` (object: slug, meta_title, meta_description, keywords, searchable_content)
- `promotion` (object: is_featured, featured_until, promotion_type, campaign_id)
- `seller` (object: display_name, profile_image, verified_seller, seller_rating, total_sales)
- `licensing` (object: license_type, usage_rights, restrictions, attribution_required)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `published_at` (datetime, optional)
- `deleted_at` (datetime, optional)
- `deleted_reason` (string, optional)

## 7. marketplace_purchases
- `_id` (string, PK)
- `buyer_id` (string, FK to users)
- `seller_id` (string, FK to users)
- `listing_id` (string, FK to marketplace_listings)
- `prompt_id` (string, FK to prompts)
- `amount` (int)
- `currency` (enum: credits|usd)
- `payment_method` (enum: credits|stripe|apple_pay|google_pay)
- `platform_fee_rate` (float)
- `platform_fee` (int)
- `seller_earnings` (int)
- `payment_status` (enum: pending|completed|failed|refunded|disputed)
- `fulfillment_status` (enum: pending|delivered|failed)
- `delivered_at` (datetime, optional)
- `download_url` (string, optional)
- `download_expires_at` (datetime, optional)
- `download_count` (int)
- `customer_satisfaction` (object: rating, review, would_recommend, reviewed_at)
- `refund` (object: amount, reason, requested_at, processed_at, status)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `completed_at` (datetime, optional)

## 8. analytics_events
- `_id` (string, PK)
- `user_id` (string, optional)
- `session_id` (string)
- `event_type` (string)
- `event_category` (string)
- `event_name` (string)
- `event_data` (object)
- `metadata` (object)
- `context` (object: page, feature, version, platform, user_agent, ip_address, country)
- `performance` (object: response_time, load_time, error_count, memory_usage)
- `business_metrics` (object: revenue, credits_spent, conversion_value, customer_lifetime_value)
- `timestamp` (datetime, UTC)
- `expires_at` (datetime, optional)

## 9. notifications
- `_id` (string, PK)
- `user_id` (string, FK to users)
- `type` (enum: info|success|warning|error|marketing)
- `title` (string)
- `message` (string)
- `action_text` (string, optional)
- `action_url` (string, optional)
- `category` (string)
- `priority` (enum: low|normal|high|urgent)
- `read` (bool)
- `read_at` (datetime, optional)
- `dismissed` (bool)
- `dismissed_at` (datetime, optional)
- `image_url` (string, optional)
- `icon_name` (string, optional)
- `icon_color` (string, optional)
- `targeted_features` (array of string)
- `user_segment` (string, optional)
- `delivery_channels` (array of string)
- `delivery_status` (object)
- `campaign_id` (string, optional)
- `batch_id` (string, optional)
- `expires_at` (datetime, optional)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)

## 10. reviews
- `_id` (string, PK)
- `prompt_id` (string, FK to prompts)
- `user_id` (string, FK to users)
- `rating` (int)
- `review` (string)
- `created_at` (datetime, UTC)
- `helpful_count` (int)

## 11. teams (optional, for future)
- `_id` (string, PK)
- `name` (string)
- `description` (string, optional)
- `avatar_url` (string, optional)
- `organization_id` (string, optional)
- `plan_type` (enum: free|pro|enterprise)
- `members` (object: user_id â†’ {role, joined_at, invited_by, permissions})
- `member_count` (int)
- `resources` (object: prompt_quota, storage_quota, ai_credits_quota, prompts_used, storage_used, ai_credits_used)
- `settings` (object: visibility, allow_invites, require_approval, default_permissions)
- `stats` (object: total_prompts, total_ideas, total_projects, active_members, monthly_activity)
- `created_at` (datetime, UTC)
- `updated_at` (datetime, UTC)
- `created_by` (string)
- `deleted_at` (datetime, optional)

---

**All collections must:**
- Use UTC for all timestamps.
- Use soft deletes (`deleted_at`) where needed.
- Denormalize display fields for performance (e.g., seller info in listings).
- Keep field names consistent (snake_case for MongoDB, camelCase for frontend if needed).
- Add/patch any missing fields in backend models and API responses to match this design.

---

**This is the single source of truth for PromptForge.ai's MongoDB schema.**
- All future migrations, patches, and code reviews must reference this file.
